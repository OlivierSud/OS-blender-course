async function loadPDFViewer(path, fileName) {
        showGlobalLoader();
        emptyState.style.display = 'none';
        pdfContainer.style.display = 'none';
        const mobileContainer = document.getElementById('mobile-pdf-container');
        mobileContainer.style.display = 'flex';

        const loader = document.getElementById('pdf-loader');
        if (loader) {
            loader.style.display = 'flex';
            loader.querySelector('p').textContent = 'Initialisation...';
        }
        canvas.style.opacity = '0'; // Hide canvas during initial fetch

        try {
            let finalPath = path;

            // Fetch as Blob for ALL sources (Drive or Local) to handle special characters and paths correctly in PDF.js
            console.log("Mobile Viewer: Preparing document:", path);

            let fetchUrl = path;
            if (path.includes('drive.google.com')) {
                const fileId = path.split('/d/')[1].split('/')[0];
                const apiKey = window.DRIVE_CONFIG ? window.DRIVE_CONFIG.apiKey : '';
                fetchUrl = `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media&key=${apiKey}`;
            } else {
                // For local files, we need to correctly encode each segment to handle '+' (which encodeURI misses)
                // and spaces. Using a URL object is the most robust way.
                const baseUrl = window.location.origin + window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/') + 1);
                // split by / and encode segments, then join back
                const encodedPath = path.split('/').map(segment => encodeURIComponent(segment)).join('/');
                fetchUrl = new URL(encodedPath, baseUrl).href;
            }

            try {
                const response = await fetch(fetchUrl);
                if (!response.ok) throw new Error(`Fetch status: ${response.status}`);
                const blob = await response.blob();

                if (window._currentMobilePdfBlob) URL.revokeObjectURL(window._currentMobilePdfBlob);
                finalPath = URL.createObjectURL(blob);
                window._currentMobilePdfBlob = finalPath;
            } catch (fetchErr) {
                console.warn("Manual mobile fetch failed, falling back to direct path:", fetchErr);
                // Fallback to the regular path if manual fetch fails
                finalPath = path;
            }

            const loadingTask = pdfjsLib.getDocument(finalPath);
            pdfDoc = await loadingTask.promise;
            document.getElementById('page-count').textContent = pdfDoc.numPages;

            pageNum = 1;
            await renderPage(pageNum);
            hideGlobalLoader();
        } catch (error) {
            console.error('Error loading PDF with PDF.js:', error);
            if (loader) loader.style.display = 'none';
            hideGlobalLoader();
            alert('Erreur lors du chargement du PDF. Essayez de rafraîchir la page.');
        }
    }
